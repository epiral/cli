<div align="center">

# Epiral CLI

**æŠŠä»»ä½•ä¸€å°ç”µè„‘å˜æˆå¯è¿œç¨‹æ§åˆ¶çš„å¼€å‘æœºã€‚**

[![Go](https://img.shields.io/badge/Go-1.25+-00ADD8?logo=go&logoColor=white)](https://go.dev)
[![License](https://img.shields.io/badge/License-MIT-blue.svg)](LICENSE)
[![Connect RPC](https://img.shields.io/badge/RPC-Connect_RPC-6C47FF)](https://connectrpc.com)

ä¸­æ–‡ | [English](README.md)

</div>

---

åœ¨ä»»æ„ä¸€å°æœºå™¨ä¸Šå®‰è£… Epiral CLI daemonï¼ŒæŒ‡å‘ä½ çš„ [Agent](https://github.com/epiral/agent) æœåŠ¡å™¨ï¼Œè¿™å°æœºå™¨å°±å˜æˆäº†ä¸€ä¸ªå¯è¿œç¨‹æ§åˆ¶çš„è®¡ç®—èŠ‚ç‚¹â€”â€”æ‰§è¡Œ shell å‘½ä»¤ã€è¯»å†™æ–‡ä»¶ã€è½¬å‘æµè§ˆå™¨å‘½ä»¤ï¼Œå…¨éƒ¨é€šè¿‡ä¸€æ¡æŒä¹…è¿æ¥å®Œæˆã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Epiral Agent (æœåŠ¡ç«¯)                       â”‚
â”‚                  ComputerHub gRPC Server                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                          â”‚
     Connect RPC                Connect RPC
     åŒå‘æµ (h2c)                åŒå‘æµ (h2c)
           â”‚                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  my-pc            â”‚   â”‚  homelab            â”‚
â”‚  MacBook Pro M2     â”‚   â”‚  Mac Mini M4        â”‚
â”‚  darwin/arm64       â”‚   â”‚  darwin/arm64       â”‚
â”‚  python3, git       â”‚   â”‚  go, node, docker   â”‚
â”‚  ğŸŒ my-chrome  â”‚   â”‚  ğŸŒ home-chrome     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ä¸ºä»€ä¹ˆéœ€è¦å®ƒ

AI ç¼–ç¨‹ Agent éœ€è¦æ“æ§çœŸå®çš„æœºå™¨ï¼Œè€Œä¸ä»…ä»…æ˜¯æ²™ç®±å®¹å™¨ã€‚ä½†æœºå™¨åœ¨ NAT åé¢ï¼Œåœ¨ä¸åŒç½‘ç»œä¸Šï¼Œæœ‰æ—¶è¿˜é€šè¿‡ä¸ç¨³å®šçš„ VPN è¿æ¥ã€‚

Epiral CLI é€šè¿‡**åå‘è¿æ¥**è§£å†³è¿™ä¸ªé—®é¢˜â€”â€”daemon ä¸»åŠ¨å‘å¤–è¿æ¥ Agent æœåŠ¡å™¨ï¼Œå»ºç«‹ä¸€æ¡æŒä¹…çš„åŒå‘æµã€‚ä¸éœ€è¦ç«¯å£è½¬å‘ï¼Œä¸éœ€è¦ SSH éš§é“ã€‚Agent èƒ½çœ‹åˆ°æ‰€æœ‰æ³¨å†Œçš„æœºå™¨ï¼Œå¯ä»¥å‘ä»»æ„ä¸€å°ä¸‹å‘å‘½ä»¤ã€‚

## ç‰¹æ€§

- **å•äºŒè¿›åˆ¶ï¼Œé›¶é…ç½®** â€” ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå‡ ä¸ªå‚æ•°ï¼Œæå®š
- **Shell æ‰§è¡Œ** â€” è¿è¡Œå‘½ä»¤ï¼Œå®æ—¶æµå¼è¿”å› stdout/stderr
- **æ–‡ä»¶æ“ä½œ** â€” è¿œç¨‹è¯»å–ã€å†™å…¥ã€ç¼–è¾‘ï¼ˆæŸ¥æ‰¾æ›¿æ¢ï¼‰æ–‡ä»¶
- **æµè§ˆå™¨æ¡¥æ¥** â€” å†…åµŒ SSE æœåŠ¡ï¼Œå°†æµè§ˆå™¨å‘½ä»¤è½¬å‘ç»™ Chrome æ’ä»¶ï¼Œè®© Agent èƒ½æ“æ§å¸¦ç”¨æˆ·ç™»å½•æ€çš„çœŸå®æµè§ˆå™¨
- **è‡ªåŠ¨é‡è¿** â€” æŒ‡æ•°é€€é¿ï¼Œè¿æ¥ç¨³å®šåè‡ªåŠ¨é‡ç½®
- **å·¥å…·å‘ç°** â€” è‡ªåŠ¨æ£€æµ‹å·²å®‰è£…å·¥å…·ï¼ˆGoã€Nodeã€Pythonã€Docker ç­‰ï¼‰å¹¶ä¸ŠæŠ¥èƒ½åŠ›
- **è·¯å¾„ç™½åå•** â€” é™åˆ¶è®¿é—®èŒƒå›´åˆ°æŒ‡å®šç›®å½•
- **å®æˆ˜éªŒè¯çš„ç¨³å®šæ€§** â€” åœ¨ ZeroTier 10% ä¸¢åŒ…ç½‘ç»œä¸‹æ­£å¸¸è¿è¡Œ

## å¿«é€Ÿå¼€å§‹

### å®‰è£…

```bash
# ä»æºç æ„å»º
git clone https://github.com/epiral/cli.git
cd cli && make build

# äºŒè¿›åˆ¶åœ¨ ./bin/epiral
```

### è¿è¡Œ

```bash
# ä»…ç”µè„‘æ¨¡å¼ï¼ˆshell + æ–‡ä»¶æ“ä½œï¼‰
./bin/epiral \
  --agent http://your-agent:8002 \
  --computer-id my-machine \
  --paths /home/me/projects

# ç”µè„‘ + æµè§ˆå™¨ï¼ˆå®Œæ•´èƒ½åŠ›ï¼‰
./bin/epiral \
  --agent http://your-agent:8002 \
  --computer-id my-machine \
  --computer-desc "æˆ‘çš„å·¥ä½œç«™" \
  --browser-id my-chrome \
  --browser-desc "æˆ‘çš„ Chrome" \
  --browser-port 19824 \
  --paths /home/me/projects
```

å®Œäº‹ã€‚ä½ çš„æœºå™¨ç°åœ¨å¯¹ Agent å¯ç”¨äº†ã€‚

```
$ ./bin/epiral --agent http://192.168.1.100:8002 --computer-id my-pc \
    --browser-id my-chrome --browser-port 19824
2026/02/06 19:40:54 [ç³»ç»Ÿ] Epiral CLI å¯åŠ¨ (v0.2.0): computer=my-pc, browser=my-chrome (port 19824)
2026/02/06 19:40:55 [è¿æ¥] å·²æ³¨å†Œç”µè„‘: my-pc (darwin/arm64)
2026/02/06 19:40:55 [æµè§ˆå™¨] SSE æœåŠ¡å·²å¯åŠ¨: port=19824, id=my-chrome
2026/02/06 19:40:55 [è¿æ¥] ç­‰å¾… Agent ä¸‹å‘å‘½ä»¤...
â–ˆ  â† ä¿æŒè¿æ¥ï¼Œç­‰å¾…å‘½ä»¤
```

## ç”¨æ³•

```
epiral [flags]
```

| å‚æ•° | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `--agent` | **æ˜¯** | â€” | Agent æœåŠ¡å™¨åœ°å€ |
| `--computer-id` | å¦* | ä¸»æœºå | æœºå™¨æ ‡è¯† |
| `--computer-desc` | å¦ | åŒ id | æ˜¾ç¤ºåç§° |
| `--browser-id` | å¦* | â€” | æµè§ˆå™¨æ ‡è¯†ï¼ˆå¯ç”¨æµè§ˆå™¨æ¡¥æ¥ï¼‰ |
| `--browser-desc` | å¦ | åŒ id | æµè§ˆå™¨æ˜¾ç¤ºåç§° |
| `--browser-port` | å¦ | â€” | Chrome æ’ä»¶ SSE æœåŠ¡ç«¯å£ |
| `--paths` | å¦ | ä¸é™åˆ¶ | Agent å¯è®¿é—®çš„è·¯å¾„ï¼Œé€—å·åˆ†éš” |
| `--token` | å¦ | â€” | è®¤è¯ token |

> \* `--computer-id` å’Œ `--browser-id` è‡³å°‘æŒ‡å®šä¸€ä¸ªã€‚

### æµè§ˆå™¨æ¡¥æ¥

æŒ‡å®š `--browser-id` å’Œ `--browser-port` åï¼Œdaemon ä¼šå¯åŠ¨ä¸€ä¸ªå†…åµŒ HTTP æœåŠ¡ï¼š

- **`GET /sse`** â€” Chrome æ’ä»¶é€šè¿‡ SSE è¿æ¥ï¼Œæ¥æ”¶å‘½ä»¤
- **`POST /result`** â€” Chrome æ’ä»¶å›ä¼ å‘½ä»¤æ‰§è¡Œç»“æœ
- **`GET /status`** â€” å¥åº·æ£€æŸ¥ï¼ˆè¿æ¥çŠ¶æ€ + pending è¯·æ±‚æ•°ï¼‰

æ•°æ®æµï¼šAgent é€šè¿‡ gRPC ä¸‹å‘æµè§ˆå™¨å‘½ä»¤ â†’ daemon é€šè¿‡ SSE è½¬å‘ç»™ Chrome æ’ä»¶ â†’ æ’ä»¶åœ¨çœŸå®æµè§ˆå™¨ä¸­æ‰§è¡Œ â†’ ç»“æœ POST åˆ° `/result` â†’ daemon é€šè¿‡ gRPC è¿”å›ç»™ Agentã€‚

### æ³¨å†Œæ—¶ä¸ŠæŠ¥çš„ä¿¡æ¯

daemon è¿æ¥æ—¶ä¼šè‡ªåŠ¨å‘é€ï¼š

| å­—æ®µ | ç¤ºä¾‹ |
|------|------|
| OS / æ¶æ„ | `darwin/arm64` |
| Shell | `/bin/zsh` |
| Home ç›®å½• | `/Users/kl` |
| å·²å®‰è£…å·¥å…· | `go 1.25`ã€`node v22.13.0`ã€`git 2.47.1`ã€`docker 27.5.1` |
| å…è®¸è·¯å¾„ | `/Users/kl/workspace` |
| æµè§ˆå™¨ï¼ˆå¦‚å¯ç”¨ï¼‰ | `my-chrome` â€” "My-PC Chrome" (åœ¨çº¿/ç¦»çº¿) |

## åè®®

åŸºäº [Connect RPC](https://connectrpc.com)ï¼ˆHTTP/2 åŒå‘æµï¼‰ã€‚ä¸€ä¸ª `Connect` RPC æ‰¿è½½æ‰€æœ‰æµé‡ï¼š

```protobuf
service ComputerHubService {
  rpc Connect(stream ConnectRequest) returns (stream ConnectResponse);
}
```

### æ¶ˆæ¯ç±»å‹

| æ–¹å‘ | æ¶ˆæ¯ | è¯´æ˜ |
|------|------|------|
| `CLI â†’ Agent` | `Registration` | ä¸ŠæŠ¥æœºå™¨èº«ä»½å’Œèƒ½åŠ› |
| `CLI â†’ Agent` | `BrowserRegistration` | æµè§ˆå™¨ä¸Šçº¿/ä¸‹çº¿çŠ¶æ€ |
| `CLI â†’ Agent` | `Ping` | å¿ƒè·³ï¼ˆæ¯ 3 ç§’ï¼‰ |
| `CLI â†’ Agent` | `ExecOutput` | æµå¼å‘½ä»¤è¾“å‡ºï¼ˆstdout + stderr + exit codeï¼‰ |
| `CLI â†’ Agent` | `FileContent` | æ–‡ä»¶è¯»å–ç»“æœ |
| `CLI â†’ Agent` | `OpResult` | å†™å…¥/ç¼–è¾‘æˆåŠŸæˆ–å¤±è´¥ |
| `CLI â†’ Agent` | `BrowserExecOutput` | æµè§ˆå™¨å‘½ä»¤æ‰§è¡Œç»“æœ |
| `Agent â†’ CLI` | `ExecRequest` | æ‰§è¡Œ shell å‘½ä»¤ |
| `Agent â†’ CLI` | `ReadFileRequest` | è¯»å–æ–‡ä»¶ï¼ˆæ”¯æŒ offset/limit åˆ†é¡µï¼‰ |
| `Agent â†’ CLI` | `WriteFileRequest` | å†™å…¥æ–‡ä»¶ï¼ˆè‡ªåŠ¨åˆ›å»ºçˆ¶ç›®å½•ï¼‰ |
| `Agent â†’ CLI` | `EditFileRequest` | æ–‡ä»¶æŸ¥æ‰¾æ›¿æ¢ |
| `Agent â†’ CLI` | `BrowserExecRequest` | æ‰§è¡Œæµè§ˆå™¨å‘½ä»¤ |
| `Agent â†’ CLI` | `Pong` | å¿ƒè·³å›åº” |

å®Œæ•´å®šä¹‰ï¼š[`proto/epiral/v1/epiral.proto`](proto/epiral/v1/epiral.proto)

## è¿æ¥ç¨³å®šæ€§

é’ˆå¯¹ä¸ç¨³å®šç½‘ç»œè®¾è®¡ã€‚åœ¨ ZeroTier ~10% ä¸¢åŒ…ã€17â€“180ms å»¶è¿ŸæŠ–åŠ¨çš„ç¯å¢ƒä¸‹è°ƒä¼˜å’ŒéªŒè¯ã€‚

```
å¿ƒè·³:         â”€â”€pingâ”€â”€pingâ”€â”€pingâ”€â”€pingâ”€â”€pingâ”€â”€pingâ”€â”€
                3s    3s    3s    3s    3s    3s

Pong æ£€æµ‹:    10 ç§’å†…æ²¡æœ‰æ”¶åˆ° Pong â†’ æ–­è¿ â†’ é‡è¿

é‡è¿é€€é¿:     1s â†’ 2s â†’ 4s â†’ 8s â†’ 16s â†’ 30s (ä¸Šé™)
              â””â”€â”€ è¿æ¥ç¨³å®š 60s åé‡ç½®ä¸º 1s
```

| å±‚çº§ | æœºåˆ¶ | è¶…æ—¶ |
|------|------|------|
| åº”ç”¨å±‚ | Ping/Pong å¿ƒè·³ | 3s é—´éš”ï¼Œ10s æˆªæ­¢ |
| HTTP/2 | `ReadIdleTimeout` | 30s |
| HTTP/2 | `PingTimeout` | 10s |
| TCP | æ‹¨å·è¶…æ—¶ | 10s |

> [!NOTE]
> æ¯æ¬¡é‡è¿éƒ½ä¼šåˆ›å»ºå…¨æ–°çš„ HTTP/2 transportï¼Œé¿å…å¤ç”¨å·²æŸåçš„è¿æ¥ã€‚

## å†…éƒ¨ç»“æ„

```
epiral-cli/
â”œâ”€â”€ cmd/epiral/
â”‚   â””â”€â”€ main.go              # å…¥å£ï¼šå‚æ•°è§£æã€ä¿¡å·å¤„ç†ã€é‡è¿å¾ªç¯
â”œâ”€â”€ internal/daemon/
â”‚   â”œâ”€â”€ daemon.go             # è¿æ¥ã€æ³¨å†Œã€å¿ƒè·³ã€æ¶ˆæ¯åˆ†å‘
â”‚   â”œâ”€â”€ exec.go               # Shell å‘½ä»¤æµå¼æ‰§è¡Œ
â”‚   â”œâ”€â”€ fileops.go            # æ–‡ä»¶è¯»å– / å†™å…¥ / ç¼–è¾‘
â”‚   â””â”€â”€ browser.go            # æµè§ˆå™¨æ¡¥æ¥ï¼šSSE æœåŠ¡ + å‘½ä»¤è½¬å‘
â”œâ”€â”€ proto/epiral/v1/
â”‚   â””â”€â”€ epiral.proto          # åè®®å®šä¹‰
â”œâ”€â”€ gen/                      # ç”Ÿæˆçš„ protobuf + Connect RPC ä»£ç 
â”œâ”€â”€ Makefile                  # build Â· generate Â· lint Â· check Â· clean
â”œâ”€â”€ buf.yaml                  # Buf protobuf å·¥å…·é“¾
â””â”€â”€ .golangci.yml             # é…ç½®äº† 13 ä¸ª linter
```

~1100 è¡Œæ‰‹å†™ Go ä»£ç ï¼Œå…¶ä½™æ˜¯ç”Ÿæˆçš„ã€‚

### å…³é”®è®¾è®¡å†³ç­–

- **åå‘è¿æ¥** â€” CLI è¿æ¥ Agentï¼ˆè€Œéåè¿‡æ¥ï¼‰ï¼Œè§£å†³ NAT ç©¿é€
- **å•æ¡åŒå‘æµ** â€” æ‰€æœ‰å‘½ä»¤å’Œå“åº”å¤ç”¨ä¸€æ¡æµï¼Œé€šè¿‡ `request_id` å…³è”
- **h2c (HTTP/2 æ˜æ–‡)** â€” å†…ç½‘æ—  TLS å¼€é”€ï¼›å…¬ç½‘æš´éœ²æ—¶åŠ åå‘ä»£ç†
- **Mutex ä¿æŠ¤å‘é€** â€” Connect RPC çš„ `stream.Send()` éå¹¶å‘å®‰å…¨ï¼Œç”¨ `sync.Mutex` ä¸²è¡ŒåŒ–æ‰€æœ‰å‡ºç«™æ¶ˆæ¯
- **å¼‚æ­¥å‘½ä»¤å¤„ç†** â€” æ¯ä¸ªä¼ å…¥å‘½ä»¤åœ¨ goroutine ä¸­å¤„ç†ï¼Œé•¿æ—¶é—´è¿è¡Œçš„ `exec` ä¸ä¼šé˜»å¡æ–‡ä»¶æ“ä½œ
- **æµè§ˆå™¨å‘½ä»¤åŒ¹é…** â€” ä½¿ç”¨ command JSON ä¸­çš„ `id` å­—æ®µï¼ˆè€Œé gRPC request IDï¼‰åŒ¹é…è¯·æ±‚å’Œå“åº”ï¼Œç¡®ä¿è·¨ SSE æ¡¥æ¥çš„æ­£ç¡®é…å¯¹

## å¼€å‘

```bash
make build      # ç¼–è¯‘åˆ° ./bin/epiral
make check      # æ ¼å¼åŒ– + lint + æ„å»ºï¼ˆæäº¤å‰æ£€æŸ¥ï¼‰
make generate   # é‡æ–°ç”Ÿæˆ protobuf ä»£ç ï¼ˆéœ€è¦ bufï¼‰
make clean      # æ¸…ç†æ„å»ºäº§ç‰©
```

### ä¾èµ–

- Go 1.25+
- [buf](https://buf.build/) â€” protobuf ä»£ç ç”Ÿæˆ
- [golangci-lint](https://golangci-lint.run/) â€” ä»£ç æ£€æŸ¥

## è·¯çº¿å›¾

- [x] æµè§ˆå™¨æ¡¥æ¥ï¼ˆåŸºäº SSE çš„ Chrome æ’ä»¶é›†æˆï¼‰
- [ ] æŒä¹…åŒ– Shell ä¼šè¯ï¼ˆShell Poolï¼‰
- [ ] ç¯å¢ƒå¿«ç…§è‡ªåŠ¨æ£€æµ‹
- [ ] mTLS / Token è®¤è¯
- [ ] Systemd / launchd æœåŠ¡æ–‡ä»¶
- [ ] äº¤å‰ç¼–è¯‘ + GitHub Releases
- [ ] å¤§æ–‡ä»¶ä¸Šä¼ ä¸‹è½½

## ç›¸å…³é¡¹ç›®

- [Epiral Agent](https://github.com/epiral/agent) â€” æœåŠ¡ç«¯ï¼ˆNode.jsï¼‰

## è®¸å¯è¯

[MIT](LICENSE)
